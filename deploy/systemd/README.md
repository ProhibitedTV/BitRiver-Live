# Systemd units

This directory provides units for the BitRiver Live control center (`bitriver-live.service`) and the BitRiver Live viewer (`bitriver-viewer.service`). The viewer unit is configured to depend on the control center so that both start in the correct order.

Install the Go API binary under `/opt/bitriver-live` (or adjust the paths) and the viewer build artefacts under `/opt/bitriver-viewer`.

1. Build the viewer with `npm run build` and copy `.next/standalone`, `.next/static`, and `public/` from `web/viewer` into `/opt/bitriver-viewer`.
2. Create an environment file `/opt/bitriver-live/.env` with production settings for the Go API. The installer generated by the control centre can be used as a reference and typically includes keys such as `BITRIVER_LIVE_ADDR` and `BITRIVER_VIEWER_ORIGIN`.
3. Create an environment file `/opt/bitriver-viewer/.env` with production settings, for example:

   ```ini
   NEXT_PUBLIC_API_BASE_URL=
   NEXT_VIEWER_BASE_PATH=/viewer
   PORT=3000
   HOSTNAME=0.0.0.0
   ```

4. (Optional) To redirect API logs to `/opt/bitriver-live/logs/server.log`, create the directory and uncomment the `StandardOutput` and `StandardError` lines in `bitriver-live.service`.
5. Enable both units:

   ```bash
   sudo systemctl enable --now bitriver-live.service
   sudo systemctl enable --now bitriver-viewer.service
   ```

The Go API proxies `/viewer` requests to the Next.js server so the admin SPA and public directory share a single origin and cookie jar.
