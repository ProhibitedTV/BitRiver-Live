# Systemd units

These unit files are optional helpers for keeping BitRiver Live running on Ubuntu and Debian hosts. Complete the basic setup in the root [README](../../README.md) first so you have working API and viewer builds to deploy here.

## Prerequisites

- **BitRiver Live binary** – From the repository root, follow the "Set up BitRiver Live at home" quickstart and run `go build ./cmd/server` to produce the `bitriver-live` executable in your working directory. Copy that binary to the machine that will run the services.
- **Viewer build output** – Follow [`web/viewer/README.md`](../../web/viewer/README.md) to run `npm run build` inside `web/viewer`. After it finishes you'll have `.next/standalone`, `.next/static`, and `public/` assets ready to publish.
- **Sudo access** – You'll run a few `sudo` commands to create directories and register the units. The first command prompts for your password if you haven't used sudo recently.

## Install the services

1. Create application directories:
   ```bash
   sudo mkdir -p /opt/bitriver-live /opt/bitriver-viewer
   ```
   Expect sudo to prompt for your password the first time.
2. Copy the BitRiver Live binary you built earlier into place and make it executable:
   ```bash
   sudo install -m 0755 /path/to/bitriver-live /opt/bitriver-live/bitriver-live
   ```
   Replace `/path/to/bitriver-live` with the compiled file from the quickstart.
3. Copy the viewer files you built from [`web/viewer/README.md`](../../web/viewer/README.md) into `/opt/bitriver-viewer`:
   ```bash
   sudo rsync -av --delete /path/to/.next/standalone/ /opt/bitriver-viewer/
   sudo rsync -av /path/to/.next/static /opt/bitriver-viewer/.next/
   sudo rsync -av /path/to/public/ /opt/bitriver-viewer/public/
   ```
   Adjust the paths if you staged the build output elsewhere.
4. Create `/opt/bitriver-live/.env` with your production settings for the Go API. The installer generated by the control centre is a good reference and usually includes keys such as `BITRIVER_LIVE_ADDR` and `BITRIVER_VIEWER_ORIGIN`.
5. Create `/opt/bitriver-viewer/.env` with viewer runtime settings. A minimal configuration looks like:
   ```ini
   NEXT_PUBLIC_API_BASE_URL=
   NEXT_VIEWER_BASE_PATH=/viewer
   PORT=3000
   HOSTNAME=0.0.0.0
   ```
6. (Optional) If you want to send API logs to `/opt/bitriver-live/logs/server.log`, create the directory and uncomment the `StandardOutput` and `StandardError` lines in `bitriver-live.service`.
7. Copy the systemd unit files into place and reload systemd:
   ```bash
   sudo install -m 0644 deploy/systemd/bitriver-live.service /etc/systemd/system/bitriver-live.service
   sudo install -m 0644 deploy/systemd/bitriver-viewer.service /etc/systemd/system/bitriver-viewer.service
   sudo systemctl daemon-reload
   ```
8. Enable and start both services:
   ```bash
   sudo systemctl enable --now bitriver-live.service
   sudo systemctl enable --now bitriver-viewer.service
   ```

The viewer unit depends on the control centre so that both start in the right order. The Go API proxies `/viewer` requests to the Next.js server, giving the admin SPA and public viewer a shared origin.

## Verify the services

Check that both services are running and healthy:

```bash
systemctl status bitriver-live.service
systemctl status bitriver-viewer.service
```

A green "active (running)" status confirms systemd launched the processes. Use `journalctl -u bitriver-live.service` or `journalctl -u bitriver-viewer.service` to inspect logs if either unit reports an error.
