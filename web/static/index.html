<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BitRiver Live Control Center</title>
    <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
    <header class="hero">
        <div class="hero__text">
            <h1>BitRiver Live</h1>
            <p>Self-hosted live streaming hub with everything you need to go live at home.</p>
        </div>
        <nav class="hero__nav">
            <button data-view="dashboard">Dashboard</button>
            <button data-view="users">Users</button>
            <button data-view="channels">Channels</button>
            <button data-view="stream">Go Live</button>
            <button data-view="chat">Chat</button>
            <button data-view="moderation">Moderation</button>
            <button data-view="profiles">Profiles</button>
            <button data-view="sessions">Sessions</button>
            <button data-view="uploads">Uploads</button>
            <button data-view="analytics">Analytics</button>
            <button data-view="settings">Settings</button>
        </nav>
        <div class="hero__actions">
            <a class="hero__link" href="/signup">Create a viewer account</a>
            <div class="hero__account" id="account-actions" hidden>
                <span id="current-user-name" class="hero__account-name"></span>
                <button id="sign-out-button" class="secondary">Sign out</button>
            </div>
        </div>
    </header>
    <main>
        <section id="dashboard" class="panel active">
            <h2>Overview</h2>
            <div class="toolbar">
                <button id="refresh-data" class="secondary">Refresh data</button>
                <button id="download-snapshot" class="secondary">Download JSON snapshot</button>
            </div>
            <div class="grid" id="overview-cards"></div>
        </section>

        <section id="users" class="panel">
            <header class="panel__header">
                <div>
                    <h2>User Management</h2>
                    <p>Invite team members, moderators, and channel owners.</p>
                </div>
                <div class="panel__actions">
                    <button id="create-user-button" class="primary">Create user</button>
                    <button id="refresh-users" class="secondary">Reload</button>
                </div>
            </header>
            <div id="users-empty" class="empty">No users yet. Use the button above to create the first account.</div>
            <div id="users-list" class="table"></div>
        </section>

        <section id="channels" class="panel">
            <header class="panel__header">
                <div>
                    <h2>Channels</h2>
                    <p>Create branded spaces for your streams.</p>
                </div>
                <div class="panel__actions">
                    <button id="create-channel-button" class="primary">Create channel</button>
                    <button id="refresh-channels" class="secondary">Reload</button>
                </div>
            </header>
            <div id="channels-empty" class="empty">Create a channel to start streaming.</div>
            <div id="channels-list" class="table"></div>
        </section>

        <section id="stream" class="panel">
            <h2>Go Live</h2>
            <p>Select a channel to control the live state without touching a terminal.</p>
            <div id="stream-controls"></div>
        </section>

        <section id="chat" class="panel">
            <h2>Channel Chat</h2>
            <div id="chat-controls"></div>
        </section>

        <section id="moderation" class="panel">
            <header class="panel__header">
                <div>
                    <h2>Moderation queue</h2>
                    <p>Review flagged chat content, triage appeals, and keep the community safe.</p>
                </div>
                <div class="panel__actions">
                    <button id="refresh-moderation" class="secondary">Refresh</button>
                </div>
            </header>
            <div class="moderation-grid">
                <section aria-labelledby="moderation-flags-heading">
                    <div class="section-header">
                        <h3 id="moderation-flags-heading">Flagged messages</h3>
                        <p class="section-subtitle">AI and moderators feed this queue in real time.</p>
                    </div>
                    <div id="moderation-queue" class="card-column"></div>
                </section>
                <section aria-labelledby="moderation-history-heading">
                    <div class="section-header">
                        <h3 id="moderation-history-heading">Recent actions</h3>
                        <p class="section-subtitle">Audit log of moderator and automation outcomes.</p>
                    </div>
                    <div id="moderation-history" class="card-column"></div>
                </section>
            </div>
        </section>

        <section id="profiles" class="panel">
            <h2>Profile Hub</h2>
            <p>Curate streamer profiles with featured channels, donation links, and friends.</p>
            <div class="profiles-layout">
                <div id="profiles-list" class="table"></div>
                <aside id="profile-detail" class="card profile-detail">
                    <div class="card__header">
                        <h3>Profile details</h3>
                        <span class="card__meta">Select a creator to inspect or edit.</span>
                    </div>
                    <p class="card__meta">No profile selected.</p>
                </aside>
            </div>
        </section>

        <section id="sessions" class="panel">
            <h2>Streaming History</h2>
            <div id="sessions-list" class="table"></div>
        </section>

        <section id="uploads" class="panel">
            <header class="panel__header">
                <div>
                    <h2>Uploads</h2>
                    <p>Register on-demand videos and monitor their processing status.</p>
                </div>
                <div class="panel__actions">
                    <button id="create-upload-button" class="primary">New upload</button>
                    <button id="refresh-uploads" class="secondary">Refresh</button>
                </div>
            </header>
            <div id="uploads-empty" class="empty">No uploads yet. Submit a file to prepare on-demand recordings.</div>
            <div id="uploads-list" class="stack"></div>
        </section>

        <section id="analytics" class="panel">
            <header class="panel__header">
                <div>
                    <h2>Analytics</h2>
                    <p>Track channel momentum, identify rising creators, and share wins with your team.</p>
                </div>
                <div class="panel__actions">
                    <button id="refresh-analytics" class="secondary">Refresh</button>
                </div>
            </header>
            <div id="analytics-overview" class="metrics-grid"></div>
            <div class="analytics-breakdown">
                <h3>Channel performance</h3>
                <p class="section-subtitle">Live viewers, watch time, and engagement for every creator.</p>
                <div id="analytics-breakdown"></div>
            </div>
        </section>

        <section id="settings" class="panel">
            <h2>Home Server Installer</h2>
            <p>The guided installer provisions directories and launches BitRiver Live as a system service.</p>
            <div id="installer"></div>
        </section>
    </main>

    <dialog id="modal">
        <form method="dialog">
            <header>
                <h3 id="modal-title"></h3>
            </header>
            <div id="modal-body"></div>
            <menu>
                <button value="cancel">Cancel</button>
                <button value="confirm" class="primary">Save</button>
            </menu>
        </form>
    </dialog>

    <template id="user-form">
        <label>
            Display name
            <input type="text" name="displayName" required />
        </label>
        <label>
            Email
            <input type="email" name="email" required />
        </label>
        <label>
            Roles (comma separated)
            <input type="text" name="roles" placeholder="admin,moderator" />
        </label>
    </template>

    <template id="channel-form">
        <label>
            Owner
            <select name="ownerId" required></select>
        </label>
        <label>
            Title
            <input type="text" name="title" required />
        </label>
        <label>
            Category
            <input type="text" name="category" />
        </label>
        <label>
            Tags (comma separated)
            <input type="text" name="tags" placeholder="retro,gaming" />
        </label>
    </template>

    <template id="profile-form">
        <p class="form-helper">Every field is optionalâ€”fill in what represents your channel brand. Donation lines follow the format <code>CURRENCY|ADDRESS|NOTE</code> (one per line).</p>
        <label>
            Bio
            <textarea name="bio" placeholder="Tell viewers what to expect"></textarea>
        </label>
        <label>
            Avatar URL
            <input type="url" name="avatarUrl" placeholder="https://cdn.example.com/avatar.png" />
        </label>
        <label>
            Banner URL
            <input type="url" name="bannerUrl" placeholder="https://cdn.example.com/banner.png" />
        </label>
        <label>
            Featured channel
            <select name="featuredChannelId"></select>
        </label>
        <label>
            Top friends (select up to 8)
            <select name="topFriends" multiple size="6"></select>
        </label>
        <label>
            Donation addresses
            <textarea name="donationAddresses" placeholder="ETH|0xabc123|Main wallet"></textarea>
        </label>
    </template>

    <template id="upload-form">
        <label>
            Channel
            <select name="channelId" required></select>
        </label>
        <label>
            Title
            <input type="text" name="title" placeholder="Spring livestream replay" />
        </label>
        <label>
            Filename
            <input type="text" name="filename" placeholder="replay.mp4" />
        </label>
        <label>
            Playback URL
            <input type="url" name="playbackUrl" placeholder="https://cdn.example.com/vod.m3u8" />
        </label>
        <label>
            File (optional)
            <input type="file" name="file" accept="video/*" />
        </label>
        <label>
            Size (bytes)
            <input type="number" name="sizeBytes" min="0" placeholder="0" />
        </label>
        <label>
            Metadata (JSON)
            <textarea name="metadata" rows="4" placeholder='{"source":"upload"}'></textarea>
        </label>
    </template>

    <template id="installer-template">
        <p>Generate a self-contained bundle and systemd service configuration without touching the shell.</p>
        <form id="installer-form">
            <label>
                Install directory
                <input type="text" name="installDir" required value="/opt/bitriver-live" />
            </label>
            <label>
                Data directory
                <input type="text" name="dataDir" required value="/var/lib/bitriver-live" />
            </label>
            <label>
                Service user
                <input type="text" name="serviceUser" required value="bitriver" />
            </label>
            <label>
                Deployment mode
                <select name="mode" required>
                    <option value="production" selected>Production (port 80, public ready)</option>
                    <option value="development">Development (:8080, local testing)</option>
                </select>
            </label>
            <label>
                HTTP listen address
                <input type="text" name="addr" required value=":80" />
            </label>
            <label>
                Public hostname (optional, used for TLS hints)
                <input type="text" name="hostname" placeholder="stream.example.com" />
            </label>
            <details class="accordion">
                <summary>TLS configuration</summary>
                <label>
                    TLS certificate path
                    <input type="text" name="tlsCert" placeholder="/etc/letsencrypt/live/stream.example.com/fullchain.pem" />
                </label>
                <label>
                    TLS key path
                    <input type="text" name="tlsKey" placeholder="/etc/letsencrypt/live/stream.example.com/privkey.pem" />
                </label>
            </details>
            <details class="accordion">
                <summary>Rate limiting &amp; Redis</summary>
                <label>
                    Global RPS cap
                    <input type="number" name="rateGlobalRps" min="0" step="1" placeholder="50" />
                </label>
                <label>
                    Login attempts per window
                    <input type="number" name="rateLoginLimit" min="0" step="1" placeholder="5" />
                </label>
                <label>
                    Login window
                    <input type="text" name="rateLoginWindow" placeholder="2m" />
                </label>
                <label>
                    Redis address (optional)
                    <input type="text" name="redisAddr" placeholder="redis:6379" />
                </label>
                <label>
                    Redis password
                    <input type="password" name="redisPassword" autocomplete="new-password" />
                </label>
            </details>
            <label class="checkbox">
                <input type="checkbox" name="enableLogs" checked />
                <span>Provision log directory and journald override</span>
            </label>
            <button type="submit" class="primary">Generate installer script</button>
        </form>
        <textarea id="installer-output" readonly rows="12" placeholder="Installer script will appear here"></textarea>
        <p class="form-helper">Copy the script, run it on your target server, and the service will build BitRiver Live, create directories, and register a <code>systemd</code> unit with sensible defaults.</p>
    </template>

    <script src="/static/app.js" type="module"></script>
</body>
</html>
