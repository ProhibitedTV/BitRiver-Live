<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BitRiver Live Control Center</title>
    <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
    <header class="hero">
        <div class="hero__text">
            <h1>BitRiver Live</h1>
            <p>Self-hosted live streaming hub with everything you need to go live at home.</p>
        </div>
        <nav class="hero__nav">
            <button data-view="dashboard">Dashboard</button>
            <button data-view="users">Users</button>
            <button data-view="channels">Channels</button>
            <button data-view="stream">Go Live</button>
            <button data-view="chat">Chat</button>
            <button data-view="moderation">Moderation</button>
            <button data-view="profiles">Profiles</button>
            <button data-view="sessions">Sessions</button>
            <button data-view="uploads">Uploads</button>
            <button data-view="analytics">Analytics</button>
            <button data-view="settings">Settings</button>
        </nav>
        <div class="hero__actions">
            <button
                id="theme-toggle"
                class="theme-toggle"
                type="button"
                aria-pressed="false"
                aria-label="Switch to light theme"
            >
                <span class="theme-toggle__icon theme-toggle__icon--sun" aria-hidden="true">â˜€</span>
                <span class="theme-toggle__icon theme-toggle__icon--moon" aria-hidden="true">ðŸŒ™</span>
            </button>
            <a class="hero__link" href="/signup">Create a viewer account</a>
            <div class="hero__account" id="account-actions" hidden>
                <span id="current-user-name" class="hero__account-name"></span>
                <button id="sign-out-button" class="secondary">Sign out</button>
            </div>
        </div>
    </header>
    <main>
        <section id="dashboard" class="panel active">
            <h2>Overview</h2>
            <div class="toolbar">
                <button id="refresh-data" class="secondary">Refresh data</button>
                <button id="download-snapshot" class="secondary">Download JSON snapshot</button>
            </div>
            <div class="grid" id="overview-cards"></div>
        </section>

        <section id="users" class="panel">
            <header class="panel__header">
                <div>
                    <h2>User Management</h2>
                    <p>Invite team members, moderators, and channel owners.</p>
                </div>
                <div class="panel__actions">
                    <button id="create-user-button" class="primary">Create user</button>
                    <button id="refresh-users" class="secondary">Reload</button>
                </div>
            </header>
            <div id="users-empty" class="empty">No users yet. Use the button above to create the first account.</div>
            <div id="users-list" class="table"></div>
        </section>

        <section id="channels" class="panel">
            <header class="panel__header">
                <div>
                    <h2>Channels</h2>
                    <p>Create branded spaces for your streams.</p>
                </div>
                <div class="panel__actions">
                    <button id="create-channel-button" class="primary">Create channel</button>
                    <button id="refresh-channels" class="secondary">Reload</button>
                </div>
            </header>
            <div id="channels-empty" class="empty">Create a channel to start streaming.</div>
            <div id="channels-list" class="table"></div>
        </section>

        <section id="stream" class="panel">
            <h2>Go Live</h2>
            <p>Select a channel to control the live state without touching a terminal.</p>
            <div id="stream-controls"></div>
        </section>

        <section id="chat" class="panel">
            <h2>Channel Chat</h2>
            <div id="chat-controls"></div>
        </section>

        <section id="moderation" class="panel">
            <header class="panel__header">
                <div>
                    <h2>Moderation queue</h2>
                    <p>Review flagged chat content, triage appeals, and keep the community safe.</p>
                </div>
                <div class="panel__actions">
                    <button id="refresh-moderation" class="secondary">Refresh</button>
                </div>
            </header>
            <div class="moderation-grid">
                <section aria-labelledby="moderation-flags-heading">
                    <div class="section-header">
                        <h3 id="moderation-flags-heading">Flagged messages</h3>
                        <p class="section-subtitle">AI and moderators feed this queue in real time.</p>
                    </div>
                    <div id="moderation-queue" class="card-column"></div>
                </section>
                <section aria-labelledby="moderation-history-heading">
                    <div class="section-header">
                        <h3 id="moderation-history-heading">Recent actions</h3>
                        <p class="section-subtitle">Audit log of moderator and automation outcomes.</p>
                    </div>
                    <div id="moderation-history" class="card-column"></div>
                </section>
            </div>
        </section>

        <section id="profiles" class="panel">
            <h2>Profile Hub</h2>
            <p>Curate streamer profiles with featured channels, donation links, and friends.</p>
            <div class="profiles-layout">
                <div id="profiles-list" class="table"></div>
                <aside id="profile-detail" class="card profile-detail">
                    <div class="card__header">
                        <h3>Profile details</h3>
                        <span class="card__meta">Select a creator to inspect or edit.</span>
                    </div>
                    <p class="card__meta">No profile selected.</p>
                </aside>
            </div>
        </section>

        <section id="sessions" class="panel">
            <h2>Streaming History</h2>
            <div id="sessions-list" class="table"></div>
        </section>

        <section id="uploads" class="panel">
            <header class="panel__header">
                <div>
                    <h2>Uploads</h2>
                    <p>Register on-demand videos and monitor their processing status.</p>
                </div>
                <div class="panel__actions">
                    <button id="create-upload-button" class="primary">New upload</button>
                    <button id="refresh-uploads" class="secondary">Refresh</button>
                </div>
            </header>
            <div id="uploads-empty" class="empty">No uploads yet. Submit a file to prepare on-demand recordings.</div>
            <div id="uploads-list" class="stack"></div>
        </section>

        <section id="analytics" class="panel">
            <header class="panel__header">
                <div>
                    <h2>Analytics</h2>
                    <p>Track channel momentum, identify rising creators, and share wins with your team.</p>
                </div>
                <div class="panel__actions">
                    <button id="refresh-analytics" class="secondary">Refresh</button>
                </div>
            </header>
            <div id="analytics-overview" class="metrics-grid"></div>
            <div class="analytics-breakdown">
                <h3>Channel performance</h3>
                <p class="section-subtitle">Live viewers, watch time, and engagement for every creator.</p>
                <div id="analytics-breakdown"></div>
            </div>
        </section>

        <section id="settings" class="panel">
            <h2>Home Server Installer</h2>
            <p>The guided installer provisions directories and launches BitRiver Live as a system service.</p>
            <div id="installer"></div>
        </section>
    </main>

    <dialog id="modal">
        <form method="dialog">
            <header>
                <h3 id="modal-title"></h3>
            </header>
            <div id="modal-body"></div>
            <menu>
                <button value="cancel">Cancel</button>
                <button value="confirm" class="primary">Save</button>
            </menu>
        </form>
    </dialog>

    <template id="user-form">
        <label>
            Display name
            <input type="text" name="displayName" required />
        </label>
        <label>
            Email
            <input type="email" name="email" required />
        </label>
        <label>
            Roles (comma separated)
            <input type="text" name="roles" placeholder="admin,moderator" />
        </label>
    </template>

    <template id="channel-form">
        <label>
            Owner
            <select name="ownerId" required></select>
        </label>
        <label>
            Title
            <input type="text" name="title" required />
        </label>
        <label>
            Category
            <input type="text" name="category" />
        </label>
        <label>
            Tags (comma separated)
            <input type="text" name="tags" placeholder="retro,gaming" />
        </label>
    </template>

    <template id="profile-form">
        <p class="form-helper">Every field is optionalâ€”fill in what represents your channel brand. Donation lines follow the format <code>CURRENCY|ADDRESS|NOTE</code> (one per line).</p>
        <label>
            Bio
            <textarea name="bio" placeholder="Tell viewers what to expect"></textarea>
        </label>
        <label>
            Avatar URL
            <input type="url" name="avatarUrl" placeholder="https://cdn.example.com/avatar.png" />
        </label>
        <label>
            Banner URL
            <input type="url" name="bannerUrl" placeholder="https://cdn.example.com/banner.png" />
        </label>
        <label>
            Featured channel
            <select name="featuredChannelId"></select>
        </label>
        <label>
            Top friends (select up to 8)
            <select name="topFriends" multiple size="6"></select>
        </label>
        <label>
            Donation addresses
            <textarea name="donationAddresses" placeholder="ETH|0xabc123|Main wallet"></textarea>
        </label>
    </template>

    <template id="upload-form">
        <label>
            Channel
            <select name="channelId" required></select>
        </label>
        <label>
            Title
            <input type="text" name="title" placeholder="Spring livestream replay" />
        </label>
        <label>
            Filename
            <input type="text" name="filename" placeholder="replay.mp4" />
        </label>
        <label>
            Playback URL
            <input type="url" name="playbackUrl" placeholder="https://cdn.example.com/vod.m3u8" />
        </label>
        <label>
            File (optional)
            <input type="file" name="file" accept="video/*" />
        </label>
        <label>
            Size (bytes)
            <input type="number" name="sizeBytes" min="0" placeholder="0" />
        </label>
        <label>
            Metadata (JSON)
            <textarea name="metadata" rows="4" placeholder='{"source":"upload"}'></textarea>
        </label>
    </template>

    <template id="installer-template">
        <section class="installer">
            <header class="installer__header">
                <span class="installer__eyebrow">No command-line experience needed</span>
                <h3>Set up BitRiver Live in three simple steps</h3>
                <p class="installer__intro">Tell us where to install, generate the script, then paste it into your home server terminal.</p>
                <ol class="installer__steps">
                    <li>
                        <strong>Fill in the basics.</strong>
                        Keep the default folders unless you already use different paths.
                    </li>
                    <li>
                        <strong>Generate the script.</strong>
                        We'll bundle every choice into a single copy-and-paste command.
                    </li>
                    <li>
                        <strong>Run it on your server.</strong>
                        Paste the script into an Ubuntu shell and follow the prompts.
                    </li>
                </ol>
            </header>
            <div class="installer__layout">
                <form id="installer-form" class="installer__form">
                    <div class="installer__group">
                        <h4>Core paths</h4>
                        <label class="installer__field">
                            <span class="installer__field-label">Install directory</span>
                            <span class="installer__field-hint">Absolute path for the BitRiver Live binaries.</span>
                            <input type="text" name="installDir" required value="/opt/bitriver-live" />
                        </label>
                        <label class="installer__field">
                            <span class="installer__field-label">Data directory</span>
                            <span class="installer__field-hint">Stores uploads, configuration, and persistent state.</span>
                            <input type="text" name="dataDir" required value="/var/lib/bitriver-live" />
                        </label>
                        <label class="installer__field">
                            <span class="installer__field-label">Service user</span>
                            <span class="installer__field-hint">A non-root user for the systemd service.</span>
                            <input type="text" name="serviceUser" required value="bitriver" />
                        </label>
                    </div>

                    <div class="installer__group">
                        <h4>Runtime</h4>
                        <label class="installer__field">
                            <span class="installer__field-label">Deployment mode</span>
                            <span class="installer__field-hint">Production binds to :80, development keeps everything on :8080.</span>
                            <select name="mode" required>
                                <option value="production" selected>Production (public ready)</option>
                                <option value="development">Development (local testing)</option>
                            </select>
                        </label>
                        <label class="installer__field">
                            <span class="installer__field-label">HTTP listen address</span>
                            <span class="installer__field-hint">Change this if you terminate TLS elsewhere.</span>
                            <input type="text" name="addr" required value=":80" />
                        </label>
                        <label class="installer__field">
                            <span class="installer__field-label">Public hostname (optional)</span>
                            <span class="installer__field-hint">Used for TLS hints and reverse proxy comments.</span>
                            <input type="text" name="hostname" placeholder="stream.example.com" />
                        </label>
                    </div>

                    <details class="installer__accordion">
                        <summary>
                            TLS configuration
                            <span>Optional</span>
                        </summary>
                        <div class="installer__accordion-body">
                            <label class="installer__field">
                                <span class="installer__field-label">TLS certificate path</span>
                                <span class="installer__field-hint">Point at your <code>fullchain.pem</code> to enable HTTPS.</span>
                                <input type="text" name="tlsCert" placeholder="/etc/letsencrypt/live/stream.example.com/fullchain.pem" />
                            </label>
                            <label class="installer__field">
                                <span class="installer__field-label">TLS key path</span>
                                <span class="installer__field-hint">Companion private key, typically <code>privkey.pem</code>.</span>
                                <input type="text" name="tlsKey" placeholder="/etc/letsencrypt/live/stream.example.com/privkey.pem" />
                            </label>
                        </div>
                    </details>

                    <details class="installer__accordion">
                        <summary>
                            Rate limiting &amp; Redis
                            <span>Optional</span>
                        </summary>
                        <div class="installer__accordion-body">
                            <label class="installer__field">
                                <span class="installer__field-label">Global RPS cap</span>
                                <span class="installer__field-hint">Throttle total requests per second (0 disables the limiter).</span>
                                <input type="number" name="rateGlobalRps" min="0" step="1" placeholder="50" />
                            </label>
                            <label class="installer__field">
                                <span class="installer__field-label">Login attempts per window</span>
                                <span class="installer__field-hint">Rate limit repeated login attempts from the same client.</span>
                                <input type="number" name="rateLoginLimit" min="0" step="1" placeholder="5" />
                            </label>
                            <label class="installer__field">
                                <span class="installer__field-label">Login window</span>
                                <span class="installer__field-hint">Duration for the login limiter (e.g. <code>2m</code>).</span>
                                <input type="text" name="rateLoginWindow" placeholder="2m" />
                            </label>
                            <label class="installer__field">
                                <span class="installer__field-label">Redis address</span>
                                <span class="installer__field-hint">Optional cache/limiter backend, host:port format.</span>
                                <input type="text" name="redisAddr" placeholder="redis:6379" />
                            </label>
                            <label class="installer__field">
                                <span class="installer__field-label">Redis password</span>
                                <span class="installer__field-hint">Stored only in the generated environment file.</span>
                                <input type="password" name="redisPassword" autocomplete="new-password" />
                            </label>
                        </div>
                    </details>

                    <label class="checkbox checkbox--stacked">
                        <input type="checkbox" name="enableLogs" checked />
                        <div>
                            <span class="installer__field-label">Provision log directory and journald override</span>
                            <span class="installer__field-hint">Creates <code>logs/</code>, rotates files, and forwards structured logs.</span>
                        </div>
                    </label>

                    <div class="installer__form-actions">
                        <button type="submit" class="primary">Generate installer script</button>
                        <p class="form-helper">Run the generated command with <code>sudo</code> on your server so the helper can finish the setup.</p>
                    </div>
                </form>

                <aside class="installer__preview">
                    <div class="installer__status" id="installer-status" role="status" aria-live="polite" data-state="idle">
                        Complete the quick form and we'll prepare the ready-to-run installer command.
                    </div>
                    <p class="installer__hint">The generated script fetches the maintained helper from GitHub, passes your options, and cleans itself up after execution.</p>
                    <textarea
                        id="installer-output"
                        class="installer__output"
                        readonly
                        rows="14"
                        placeholder="Installer script will appear here"
                    ></textarea>
                    <div class="installer__actions">
                        <button type="button" class="secondary" id="copy-installer" disabled>Copy script</button>
                        <a
                            class="installer__docs"
                            href="https://github.com/BitRiver-Live/BitRiver-Live/blob/main/docs/installing-on-ubuntu.md"
                            target="_blank"
                            rel="noreferrer"
                        >Ubuntu install guide â†—</a>
                    </div>
                    <div class="installer__summary">
                        <h4>Selected options</h4>
                        <dl class="installer__summary-list">
                            <div class="installer__summary-item">
                                <dt>Install directory</dt>
                                <dd data-summary="installDir">/opt/bitriver-live</dd>
                            </div>
                            <div class="installer__summary-item">
                                <dt>Data directory</dt>
                                <dd data-summary="dataDir">/var/lib/bitriver-live</dd>
                            </div>
                            <div class="installer__summary-item">
                                <dt>Service user</dt>
                                <dd data-summary="serviceUser">bitriver</dd>
                            </div>
                            <div class="installer__summary-item">
                                <dt>Mode</dt>
                                <dd data-summary="mode">Production (port 80)</dd>
                            </div>
                            <div class="installer__summary-item">
                                <dt>Listen address</dt>
                                <dd data-summary="addr">:80</dd>
                            </div>
                            <div class="installer__summary-item">
                                <dt>Hostname</dt>
                                <dd data-summary="hostname">Not provided</dd>
                            </div>
                            <div class="installer__summary-item">
                                <dt>Logs</dt>
                                <dd data-summary="enableLogs">Provisioned</dd>
                            </div>
                            <div class="installer__summary-item">
                                <dt>Log directory</dt>
                                <dd data-summary="logDir">/var/lib/bitriver-live/logs</dd>
                            </div>
                        </dl>
                    </div>
                    <div class="installer__checklist">
                        <h4>Run the script on your server</h4>
                        <ol>
                            <li>SSH into your Ubuntu 22.04+ machine with an account that can use <code>sudo</code>.</li>
                            <li>Paste the generated script and press Enter to start the guided install.</li>
                            <li>Follow the prompts to connect storage and create your admin account.</li>
                            <li>Open the address printed at the end of the script to sign in to BitRiver Live.</li>
                        </ol>
                    </div>
                </aside>
            </div>
        </section>
    </template>

    <script src="/static/app.js" type="module"></script>
</body>
</html>
